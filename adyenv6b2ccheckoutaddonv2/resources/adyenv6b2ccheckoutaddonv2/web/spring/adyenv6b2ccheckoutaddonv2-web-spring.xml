<?xml version="1.0" encoding="UTF-8"?>
<!--
 Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
-->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
	   xmlns:mvc="http://www.springframework.org/schema/mvc"
	   xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/aop
           http://www.springframework.org/schema/aop/spring-aop.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context.xsd">
           
    <context:annotation-config/>

	<context:component-scan base-package="com.adyen.v6.controllers"/>

	<!-- Expose /acceleratoraddon/web/webroot/WEB-INF/messages/base.js.properties  resource bundle as javascript variables -->
	<bean id="defaultAdyenv6b2ccheckoutaddonv2JavaScriptMessageResourceAccessor" parent="abstractJavaScriptMessageResourceAccessor">
		<property name="addOnName" value="adyenv6b2ccheckoutaddonv2"/>
	</bean>

	<bean id="defaultAdyenv6b2ccheckoutaddonv2BeforeViewJsPropsHandlerAdaptee" parent="abstractBeforeViewJsPropsHandlerAdaptee" class="de.hybris.platform.addonsupport.interceptors.ExportJsPropertiesBeforeViewHandler">
		<property name="messageSource" ref="defaultAdyenv6b2ccheckoutaddonv2JavaScriptMessageResourceAccessor"/>
	</bean>

	<bean id="getAdyenv6b2ccheckoutaddonv2BeforeViewHandler" parent="beforeViewHandlerAdapter">
		<property name="adaptee">
			<ref bean="defaultAdyenv6b2ccheckoutaddonv2BeforeViewJsPropsHandlerAdaptee"/>
		</property>
	</bean>
	<bean id="Adyenv6b2ccheckoutaddonv2BeforeViewHandlerListMergeDirective" depends-on="beforeViewHandlersList" parent="listMergeDirective">
		<property name="add" ref="getAdyenv6b2ccheckoutaddonv2BeforeViewHandler"/>
	</bean>


<!--	<bean id="REDIRECT_MULTI_STEP_CHECKOUT" class="java.lang.String">
		<constructor-arg value="redirect:/checkout/multi/adyen"/>
	</bean>-->

	<alias name="defaultAdyenB2CResponsiveMultiStepCheckout" alias="adyenB2CResponsiveMultiStepCheckout" />
	<bean id="defaultAdyenB2CResponsiveMultiStepCheckout" parent="checkoutStep">
		<property name="checkoutGroup" ref="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepValidator" ref="defaultResponsiveMultiStepCheckoutValidator"/>
		<property name="transitions">
			<map>
				<entry key="previous" value-ref="REDIRECT_TO_CART"/>
				<entry key="current" value-ref="REDIRECT_MULTI_STEP_CHECKOUT"/>
				<entry key="next" value-ref="REDIRECT_TO_DELIVERY_ADDRESS"/>
			</map>
		</property>
		<property name="progressBarId" value="multi"/>
	</bean>

	<alias name="defaultAdyenB2CResponsiveDeliveryAddressCheckoutStep" alias="adyenB2CResponsiveDeliveryAddressCheckoutStep" />
	<bean id="defaultAdyenB2CResponsiveDeliveryAddressCheckoutStep" parent="checkoutStep">
		<property name="checkoutGroup" ref="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepValidator" ref="defaultResponsiveDeliveryAddressCheckoutValidator"/>
		<property name="transitions">
			<map merge="true">
				<entry key="previous" value-ref="REDIRECT_TO_CART"/>
				<entry key="current" value-ref="REDIRECT_TO_DELIVERY_ADDRESS"/>
				<entry key="next" value-ref="REDIRECT_TO_DELIVERY_METHOD"/>
			</map>
		</property>
		<property name="progressBarId" value="deliveryAddress"/>
	</bean>

	<alias name="defaultAdyenB2CResponsiveDeliveryMethodCheckoutStep" alias="adyenB2CResponsiveDeliveryMethodCheckoutStep" />
	<bean id="defaultAdyenB2CResponsiveDeliveryMethodCheckoutStep"  parent="checkoutStep">
		<property name="checkoutGroup" ref="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepValidator" ref="defaultResponsiveDeliveryMethodCheckoutValidator"/>
		<property name="transitions">
			<map merge="true">
				<entry key="previous" value-ref="REDIRECT_TO_DELIVERY_ADDRESS"/>
				<entry key="current" value-ref="REDIRECT_TO_DELIVERY_METHOD"/>
				<entry key="next" value-ref="REDIRECT_TO_PAYMENT_METHOD_ADYEN"/>
			</map>
		</property>
		<property name="progressBarId" value="deliveryMethod"/>
	</bean>

	<alias name="defaultAdyenB2CResponsiveChoosePaymentCheckoutStep" alias="adyenB2CResponsiveChoosePaymentCheckoutStep"/>
	<bean id="defaultAdyenB2CResponsiveChoosePaymentCheckoutStep" parent="checkoutStep">
		<property name="checkoutGroup" ref="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepValidator" ref="defaultPaymentMethodCheckoutValidator"/>
		<property name="transitions">
			<map merge="true">
				<entry key="previous" value-ref="REDIRECT_TO_DELIVERY_METHOD"/>
				<entry key="current" value-ref="REDIRECT_TO_PAYMENT_METHOD_ADYEN"/>
				<entry key="next" value-ref="REDIRECT_TO_SUMMARY_ADYEN"/>
			</map>
		</property>
		<property name="progressBarId" value="paymentMethod"/>
	</bean>

	<alias name="defaultAdyenB2CResponsivePaymentMethodCheckoutStep" alias="adyenB2CResponsivePaymentMethodCheckoutStep" />
	<bean id="defaultAdyenB2CResponsivePaymentMethodCheckoutStep" parent="checkoutStep">
		<property name="checkoutGroup" ref="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepValidator" ref="defaultResponsivePaymentMethodCheckoutValidator"/>
		<property name="transitions">
			<map merge="true">
				<entry key="previous" value-ref="REDIRECT_TO_PAYMENT_METHOD_ADYEN"/>
				<entry key="current" value-ref="REDIRECT_TO_PAYMENT_METHOD"/>
				<entry key="next" value-ref="REDIRECT_TO_SUMMARY_ADYEN"/>
			</map>
		</property>
		<property name="progressBarId" value="paymentMethod"/>
	</bean>

	<alias name="defaultAdyenB2CResponsiveSummaryCheckoutStep" alias="adyenB2CResponsiveSummaryCheckoutStep" />
	<bean id="defaultAdyenB2CResponsiveSummaryCheckoutStep"  parent="checkoutStep">
		<property name="checkoutGroup" ref="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepValidator" ref="defaultResponsiveSummaryCheckoutValidator"/>
		<property name="transitions">
			<map merge="true">
				<entry key="previous" value-ref="REDIRECT_TO_PAYMENT_METHOD_ADYEN"/>
				<entry key="current" value-ref="REDIRECT_TO_SUMMARY_ADYEN"/>
				<entry key="next" value="redirect:/checkout/adyen/orderConfirmation/%s"/>
			</map>
		</property>
		<property name="progressBarId" value="confirmOrder"/>
	</bean>


	<bean id="adyenB2CResponsiveCheckoutGroup"  class="de.hybris.platform.acceleratorstorefrontcommons.checkout.steps.CheckoutGroup">
		<property name="groupId"  value="adyenB2CResponsiveCheckoutGroup"/>
		<property name="checkoutStepMap">
			<map merge="true">
				<entry key="multi" value-ref="adyenB2CResponsiveMultiStepCheckout"/>
				<entry key="delivery-address" value-ref="adyenB2CResponsiveDeliveryAddressCheckoutStep"/>
				<entry key="delivery-method" value-ref="adyenB2CResponsiveDeliveryMethodCheckoutStep"/>
				<entry key="choose-payment-method" value-ref="adyenB2CResponsiveChoosePaymentCheckoutStep"/>
				<entry key="payment-method" value-ref="adyenB2CResponsivePaymentMethodCheckoutStep"/>
				<entry key="summary" value-ref="adyenB2CResponsiveSummaryCheckoutStep"/>
			</map>
		</property>
		<property name="validationResultsMap">
			<map merge="true">
				<entry key="FAILED" value-ref="REDIRECT_TO_CART"/>
				<entry key="REDIRECT_TO_DELIVERY_ADDRESS" value-ref="REDIRECT_TO_DELIVERY_ADDRESS"/>
				<entry key="REDIRECT_TO_CART" value-ref="REDIRECT_TO_CART"/>
				<entry key="REDIRECT_TO_PAYMENT_METHOD" value-ref="REDIRECT_TO_PAYMENT_METHOD_ADYEN"/>
				<entry key="REDIRECT_TO_DELIVERY_METHOD" value-ref="REDIRECT_TO_DELIVERY_METHOD"/>
				<entry key="REDIRECT_TO_SUMMARY" value-ref="REDIRECT_TO_SUMMARY_ADYEN"/>
			</map>
		</property>
		<property name="checkoutProgressBar">
			<map merge="true">
				<entry key="1" value-ref="adyenB2CResponsiveDeliveryAddressCheckoutStep"/>
				<entry key="2" value-ref="adyenB2CResponsiveDeliveryMethodCheckoutStep"/>
				<entry key="3" value-ref="adyenB2CResponsiveChoosePaymentCheckoutStep"/>
				<entry key="4" value-ref="adyenB2CResponsiveSummaryCheckoutStep"/>
			</map>
		</property>
	</bean>



	<bean id="adyenCheckoutFlowGroupResponsiveMapMergeDirective" parent="mapMergeDirective" depends-on="checkoutFlowGroupMap">
		<property name="key" value="adyenB2CResponsiveCheckoutGroup"/>
		<property name="value" ref="adyenB2CResponsiveCheckoutGroup"/>
	</bean>


	<bean id="REDIRECT_TO_SUMMARY_ADYEN" class="java.lang.String">
		<constructor-arg value="redirect:/checkout/multi/adyen/summary/view"/>
	</bean>

	<bean id="REDIRECT_TO_PAYMENT_METHOD_ADYEN" class="java.lang.String">
		<constructor-arg value="redirect:/checkout/multi/adyen/select-payment-method"/>
	</bean>

	<bean id="sameSiteCookieAttributeAppenderUtils" class="com.adyen.v6.utils.SameSiteCookieAttributeAppenderUtils" >
		<property name="configurationService" ref="configurationService" />
	</bean>

	<!-- SameSite cookie Authentication Handler -->
	<bean id="loginGuidAuthenticationSuccessHandler" class="com.adyen.v6.security.AdyenGUIDAuthenticationSuccessHandler" >
		<property name="authenticationSuccessHandler" ref="loginAuthenticationSuccessHandler" />
		<property name="guidCookieStrategy" ref="guidCookieStrategy" />
		<property name="sameSiteCookieAttributeAppenderUtils" ref="sameSiteCookieAttributeAppenderUtils" />
	</bean>
	<bean id="loginCheckoutGuidAuthenticationSuccessHandler" class="com.adyen.v6.security.AdyenGUIDAuthenticationSuccessHandler" >
		<property name="authenticationSuccessHandler" ref="loginCheckoutAuthenticationSuccessHandler" />
		<property name="guidCookieStrategy" ref="guidCookieStrategy" />
		<property name="sameSiteCookieAttributeAppenderUtils" ref="sameSiteCookieAttributeAppenderUtils" />
	</bean>

	<!-- SameSite cookie Filter -->
	<bean id="sameSiteCookiePostProcessFilter" class="com.adyen.v6.filters.SameSiteCookiePostProcessFilter" >
		<property name="sameSiteCookieAttributeAppenderUtils" ref="sameSiteCookieAttributeAppenderUtils" />
	</bean>
	<bean id="sameSiteCookiePostProcessFilterListMergeDirective" depends-on="defaultStorefrontTenantDefaultFilterChainList" parent="listMergeDirective">
		<property name="add" ref="sameSiteCookiePostProcessFilter"/>
	</bean>

	<!-- SameSite cookie Handler Interceptor -->
	<bean id="sameSiteCookieHandlerInterceptorAdapter" class="com.adyen.v6.interceptors.SameSiteCookieHandlerInterceptorAdapter" >
		<property name="sameSiteCookieAttributeAppenderUtils" ref="sameSiteCookieAttributeAppenderUtils" />
	</bean>

	<alias name="adyenAddressValidator" alias="addressValidator"/>
	<bean id="adyenAddressValidator" class="com.adyen.v6.validator.AdyenAddressValidator"/>

	<!--<alias name="adyenPaymentMethodCheckoutStepController" alias="paymentMethodCheckoutStepController"/>
	<bean id="adyenPaymentMethodCheckoutStepController" class="com.adyen.v6.controllers.pages.checkout.steps.AdyenPaymentMethodCheckoutStepController"/>-->

	<alias name="adyenDeliveryAddressCheckoutStepController" alias="deliveryAddressCheckoutStepController"/>
	<bean id="adyenDeliveryAddressCheckoutStepController" class="com.adyen.v6.controllers.pages.checkout.steps.AdyenDeliveryAddressCheckoutStepController"/>


</beans>
